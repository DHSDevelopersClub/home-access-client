<dom-module id="polymer-table">
  <template>
    <content></content>
    <table>
      <tr class="headers"></tr>
    </table>
  </template>

  <script>
    (function () {
      Polymer({
        is: "polymer-table",
        properties: {
          data: {
            type: Array,
            value: []
          }
        },
        attached: function() {
           this.async(function() {
             var tableLocation = this.querySelectorAll('table')[0];
             var tableHeaders = this.getElementsByClassName("headers")[0];
             var columnElements = this.querySelectorAll('polymer-column');
             var columns = [];
             var tableText = tableLocation.innerHTML;
             console.log(columnElements);
             [].forEach.call(columnElements, function(c) {
               columns.push(c.attributes.name.value);
               tableText += '<th>' + c.innerHTML + '</th>';
             });
             console.log(this.data);
             console.log(columns);
             this.data.forEach(function(rowData) {
               console.log(rowData);
               tableText += '<tr>';
               columns.forEach(function(column) {
                 tableText += '<td>' + JSON.stringify(rowData[column]) + '</td>';
               });
               tableText += '</tr>';
             });
             tableLocation.innerHTML = tableText;
           });
        }
      });
    })();
  </script>

</dom-module>
